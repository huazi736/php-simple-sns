<?php/*** 框架启动文件* * @author mawenpei<mawenpei@duankou.com>* @since <2012/06/19>* @version 1.3* */define('CI_VERSION', '2.1.0');require_once CONFIG_PATH . 'constants.php';require_once CONFIG_PATH . 'tables.php';require(EXTEND_PATH . 'helpers/common_helper'.EXT);//设定错误和异常处理//set_exception_handler('_exception_handler');//set_error_handler('_error_handler');//注册类自动加载if(function_exists('spl_autoload_register')){	spl_autoload_register('autoload');}//if ( ! is_php('5.3'))//{//	@set_magic_quotes_runtime(0); // Kill magic quotes//}//实例化请求类$RES = DK_Request::getInstance();//实例化路由类$RTR = DK_Router::getInstance();$RTR->parseRouter($RES);//基准测试$BM =& load_class('Benchmark', 'core');$BM->mark('total_execution_time_start');$BM->mark('loading_time:_base_classes_start');//实例化配置文件类$CFG =& load_class('Config', 'core');//实例化编码类$UNI =& load_class('Utf8', 'core');//$SEC =& load_class('Security', 'core');//$IN	=& load_class('Input', 'core');//$LANG =& load_class('Lang', 'core');//$OUT = & load_class('Output', 'core');require_once EXTEND_PATH . 'libraries' .DS . 'DK_MSession.php';$session = DK_MSession::getInstance();if(LOCAL_RUN == false){       session_set_cookie_params(0,'/',DOMAIN);}session_set_save_handler(array($session,"open"),array($session,"close"),array($session,"read"),array($session,"write"),array($session,"destroy"),array($session,"gc"));//ini_set('session.save_handler','memcache');//ini_set('session.save_path','tcp://192.168.12.252:11212,tcp://192.168.12.252:11211');//ini_set('session.gc_maxlifetime','3600');//解决上传插件session丢失问题if(isset($_POST['sessionid']) && strlen($_POST['sessionid'])== 26){
	session_id($_POST['sessionid']);
}session_start();$BM->mark('loading_time:_base_classes_end');$BM->mark('controller_execution_time_( '.$RTR->getController().' / '.$RTR->getAction().' )_start');$RTR->dispatcher();if (class_exists('CI_DB') AND isset($CI->db)){	$CI->db->close();}